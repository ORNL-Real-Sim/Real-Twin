##############################################################################
# Copyright (c) 2024, Oak Ridge National Laboratory                          #
# All rights reserved.                                                       #
#                                                                            #
# This file is part of RealTwin and is distributed under a __TBD__           #
# license. For the licensing terms see the LICENSE file in the top-level     #
# directory.                                                                 #
#                                                                            #
# Contact realtwin developer @ realtwin@ornl.gov                             #
##############################################################################

# We will provide the default values for the configurations
# user can override these values by providing the same key and different values

input_dir: C:\Users\xh8\ornl_work\github_workspace\Real-Twin\datasets\chattanooga
output_dir:  # optional

# Absolute and Concrete Scenario Generation
Traffic:
    Volume: GridSmart_demand.csv
    TurningRatio: GridSmart_demand.csv
    GridSmart_lookup: GridSmart_lookuptable.csv
Network:
    NetworkName: chatt
    NetworkVertices: (-85.14977588011192, 35.040346288414916), (-85.15823020212477, 35.04345144844759), (-85.15829457513502, 35.043293338482925), (-85.14986171079225, 35.04018378032611)
    Net_BBox:  # optional
    ElevationMap: chatt_elev.tif  # optional
Control:
    Signal: Synchro_signal.csv
    Synchro_lookup: Synchro_lookuptable.csv

# Turn, inFlow and Behavior Calibration
Calibration:
    # overall configuration for the calibration
    scenario_config:
        sim_start_time: 28800  # 8:00 AM
        sim_end_time: 32400  # 9:00 AM
        calibration_target:
            GEH: 5  # https://en.wikipedia.org/wiki/GEH_statistic
            GEHPercent: 0.85  # accepted match
        calibration_interval: 60  # mins
        demand_interval: 15  # mins

        # input files for the calibration
        path_turn: "turn.xlsx"
        path_inflow: "inflow.xlsx"
        path_summary: "summary.xlsx"
        path_updated_signal: "updated_signal.xml"
        path_Edge_add: "Edge.add.xml"
        # path_edge: "EdgeData.xml"   # the EdgeData.xml is generated by the simulation

    # configuration for the Genetic Algorithm
    ga_config:
        # turn and inflow
        num_generations: 10
        num_variables: 16
        num_turning_ratio: 12  # remaining should be inflow
        ubc: 200  # upper bound of inflow
        population_size: 2  # population size must be even
        crossover_rate: 0.75
        mutation_rate: 0.1
        elitism_size: 1  # number of elite individuals to carry over
        best_fitness_value: 999999  # Large Num, avoid inf
        max_no_improvement: 5  # stop if no improvement in this iteration

        # behavior calibration
        EB_tt: 240  # mins?
        WB_tt: 180  # mins?
        EB_edge_list: ["-312", "-293", "-297", "-288", "-286",
                       "-302", "-3221", "-322", "-313", "-284",
                       "-328", "-304"]
        WB_edge_list: ["-2801", "-280", "-307", "-327", "-281",
                       "-315", "-321", "-300", "-2851", "-285",
                       "-290", "-298", "-295"]
        initial_params:
            min_gap: 2.5  # min gap between vehicles in meters
            acceleration: 2.6  #  max acceleration in m/s^2
            deceleration: 4.5  # max deceleration in m/s^2
            sigma: 0.5  # driver imperfection
            tau: 1.00  # desired headway
            emergencyDecel: 9.0  # emergency deceleration in m/s^2
        params_ranges:
            min_gap: [1.0, 3.0]
            acceleration: [2.5, 3.0]
            deceleration: [4.0, 5.3]
            sigma: [0.0, 1.0]
            tau: [0.25, 1.25]
            emergencyDecel: [5.0, 9.3]

    # configuration for the Simulated Annealing
    sa_config:
        # turn and inflow and behavior
        max_iteration: 3
        initial_temperature: 100
        cooling_rate: 0.891

        # turn and inflow only
        num_variables: 16
        num_turning_ratio: 12  # remaining should be inflow
        ubc: 200  # upper bound of inflow
        cost_difference: 2
        accept_prob: 0.5
        stopping_temperature: 0.001
        lower_bound: 0
        upper_bound: 1

        # behavior calibration
        EB_tt: 240  # mins?
        WB_tt: 180  # mins?
        EB_edge_list: ["-312", "-293", "-297", "-288", "-286",
                       "-302", "-3221", "-322", "-313", "-284",
                       "-328", "-304"]
        WB_edge_list: ["-2801", "-280", "-307", "-327", "-281",
                       "-315", "-321", "-300", "-2851", "-285",
                       "-290", "-298", "-295"]
        initial_params:
            min_gap: 2.5  # min gap between vehicles in meters
            acceleration: 2.6  #  max acceleration in m/s^2
            deceleration: 4.5  # max deceleration in m/s^2
            sigma: 0.5  # driver imperfection
            tau: 1.00  # desired headway
            emergencyDecel: 9.0  # emergency deceleration in m/s^2
        params_ranges:
            min_gap: [1.0, 3.0]
            acceleration: [2.5, 3.0]
            deceleration: [4.0, 5.3]
            sigma: [0.0, 1.0]
            tau: [0.25, 1.25]
            emergencyDecel: [5.0, 9.3]

    # configuration for the Tabu Search
    ts_config:
        # turn and inflow
        iterations: 3
        tabu_size: 120
        neighborhood_size: 32
        move_range: 0.5   # initial move range
        num_turning_ratio: 12
        max_no_improvement_local: 5
        max_no_improvement_global: 30
        lower_bound: 0
        upper_bound: 1
        lbc: 0  # lower bound for inflow counts
        ubc: 200  # upper bound for inflow counts

        # behavior
        max_iteration: 50
        num_neighbors: 5
        tabu_list_size: 10
        decimal_places: 5

        EB_tt: 240  # mins?
        WB_tt: 180  # mins?
        EB_edge_list: ["-312", "-293", "-297", "-288", "-286",
                       "-302", "-3221", "-322", "-313", "-284",
                       "-328", "-304"]
        WB_edge_list: ["-2801", "-280", "-307", "-327", "-281",
                       "-315", "-321", "-300", "-2851", "-285",
                       "-290", "-298", "-295"]
        initial_params:
            min_gap: 2.5  # min gap between vehicles in meters
            acceleration: 2.6  #  max acceleration in m/s^2
            deceleration: 4.5  # max deceleration in m/s^2
            sigma: 0.5  # driver imperfection
            tau: 1.00  # desired headway
            emergencyDecel: 9.0  # emergency deceleration in m/s^2
        params_ranges:
            min_gap: [1.0, 3.0]
            acceleration: [2.5, 3.0]
            deceleration: [4.0, 5.3]
            sigma: [0.0, 1.0]
            tau: [0.25, 1.25]
            emergencyDecel: [5.0, 9.3]
